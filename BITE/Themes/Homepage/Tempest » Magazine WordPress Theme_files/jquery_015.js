(function($){$.tiny=$.tiny||{};$.tiny.scrollbar={options:{axis:'y',wheel:40,scroll:true,size:'auto',sizethumb:'auto',animate:300,contentDrag:false}};$.fn.tinyscrollbar=function(a){var a=$.extend({},$.tiny.scrollbar.options,a);this.each(function(){$(this).data('tsb',new Scrollbar($(this),a))});return this};$.fn.tinyscrollbar_update=function(a){return $(this).data('tsb').update(a)};$.fn.tinyscrollbar_drag=function(a){return $(this).data('tsb').contentDrag(a)};function Scrollbar(d,e){var f=this;var g=d;var h={obj:$('.viewport',d)};var i={obj:$('.overview',d)};var j={obj:$('.scrollbar',d)};var k={obj:$('.track',j.obj)};var l={obj:$('.thumb',j.obj)};var m=e.axis=='x',sDirection=m?'left':'top',sSize=m?'Width':'Height';var n,iPosition={start:0,now:0},iMouse={};var o={status:false,start:0,now:0};var x=false;y=false;var z=false;function initialize(){f.update();setEvents();return f}this.update=function(a){h[e.axis]=h.obj[0]['offset'+sSize];i[e.axis]=i.obj[0]['scroll'+sSize];i.ratio=h[e.axis]/i[e.axis];j.obj.toggleClass('disable',i.ratio>=1);k[e.axis]=e.size=='auto'?h[e.axis]:e.size;l[e.axis]=Math.min(k[e.axis],Math.max(0,(e.sizethumb=='auto'?(k[e.axis]*i.ratio):e.sizethumb)));j.ratio=e.sizethumb=='auto'?(i[e.axis]/k[e.axis]):(i[e.axis]-h[e.axis])/(k[e.axis]-l[e.axis]);n=(a=='relative'&&i.ratio<=1)?Math.min((i[e.axis]-h[e.axis]),Math.max(0,n)):0;n=(a=='bottom'&&i.ratio<=1)?(i[e.axis]-h[e.axis]):isNaN(parseInt(a))?n:parseInt(a);setSize()};this.contentDrag=function(a){if(!(i.ratio>=1)){n=Math.min((i[e.axis]-h[e.axis]),Math.max(0,a));l.obj.css(sDirection,n/j.ratio);i.obj.css(sDirection,-n)}};function setSize(){l.obj.css(sDirection,n/j.ratio);i.obj.css(sDirection,-n);iMouse['start']=l.obj.offset()[sDirection];var a=sSize.toLowerCase();j.obj.css(a,k[e.axis]);k.obj.css(a,k[e.axis]);l.obj.css(a,l[e.axis])};function setEvents(){l.obj.bind('mousedown',start);l.obj[0].ontouchstart=function(a){a.preventDefault();l.obj.unbind('mousedown');start(a.touches[0]);return false};k.obj.bind('mouseup',drag);if(e.scroll&&this.addEventListener){g[0].addEventListener('DOMMouseScroll',wheel,false);g[0].addEventListener('mousewheel',wheel,false)}else if(e.scroll){g[0].onmousewheel=wheel}if(e.contentDrag){i.obj.bind('mousedown.tiny',function(a){o.status=true;o.start=Math.abs(i.obj.css(sDirection).replace('px',''));o.now=m?a.pageX:a.pageY}).bind('mouseup.tiny',function(){o.status=false}).bind('mouseleave.tiny',function(){o.status=false}).bind('mousemove.tiny',function(b){if(o.status==true){a=o.start+o.now-(m?b.pageX:b.pageY);f.contentDrag(a)}});if("ontouchstart"in window===true){i.obj.unbind('.tiny').bind('touchstart.tiny',function(a){o.start=Math.abs(i.obj.css(sDirection).replace('px',''));o.now=m?a.originalEvent.touches[0].pageX:a.originalEvent.touches[0].pageY;$(this).bind('touchmove.tiny',function(b){b.preventDefault();a=o.start+o.now-(m?b.originalEvent.touches[0].pageX:b.originalEvent.touches[0].pageY);f.contentDrag(a)})}).bind('touchend.tiny',function(){$(this).unbind('touchmove.dragContent')})}}};function start(b){y=true;iMouse.start=m?b.pageX:b.pageY;var c=parseInt(l.obj.css(sDirection));iPosition.start=c=='auto'?0:c;$(document).bind('mousemove',drag);document.ontouchmove=function(a){$(document).unbind('mousemove');drag(a.touches[0])};$(document).bind('mouseup',end);l.obj.bind('mouseup',end);l.obj[0].ontouchend=document.ontouchend=function(a){$(document).unbind('mouseup');l.obj.unbind('mouseup');end(a.touches[0])};return false};function wheel(a){if(!(i.ratio>=1)){var a=a||window.event;var b=a.wheelDelta?a.wheelDelta/120:-a.detail/3;n-=b*e.wheel;n=Math.min((i[e.axis]-h[e.axis]),Math.max(0,n));l.obj.css(sDirection,n/j.ratio);i.obj.css(sDirection,-n);a=$.event.fix(a);a.preventDefault()}};function end(a){y=false;$(document).unbind('mousemove',drag);$(document).unbind('mouseup',end);l.obj.unbind('mouseup',end);document.ontouchmove=l.obj[0].ontouchend=document.ontouchend=null;return false};function drag(a){if(!(i.ratio>=1)){iPosition.now=Math.min((k[e.axis]-l[e.axis]),Math.max(0,(iPosition.start+((m?a.pageX:a.pageY)-iMouse.start))));n=iPosition.now*j.ratio;if(e.animate==0||(e.animate>0&&y==true)){i.obj.css(sDirection,-n);l.obj.css(sDirection,iPosition.now)}else{if(z==false){z=true;if(sDirection=='top'){$(i.obj.selector).animate({'top':-n+'px'},e.animate);$(l.obj.selector).animate({'top':iPosition.now+'px'},e.animate,function(){z=false})}else{$(i.obj.selector).animate({'left':-n+'px'},e.animate);$(l.obj.selector).animate({'left':iPosition.now+'px'},e.animate,function(){z=false})}}}}return false};return initialize()}})(jQuery);